<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>ぬめぬめ動く棒グラフ Bar Chart Race を描いてみよう: 準備編 | MlxShake</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="ぬめぬめ動く棒グラフ Bar Chart Race を描いてみよう: 準備編" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Export Matlab Live Scripts to Markdown" />
<meta property="og:description" content="Export Matlab Live Scripts to Markdown" />
<link rel="canonical" href="/examples/qiita/barChartRaceExample_part1.html" />
<meta property="og:url" content="/examples/qiita/barChartRaceExample_part1.html" />
<meta property="og:site_name" content="MlxShake" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ぬめぬめ動く棒グラフ Bar Chart Race を描いてみよう: 準備編" />
<script type="application/ld+json">
{"description":"Export Matlab Live Scripts to Markdown","url":"/examples/qiita/barChartRaceExample_part1.html","headline":"ぬめぬめ動く棒グラフ Bar Chart Race を描いてみよう: 準備編","dateModified":"2021-09-11T10:11:29-04:00","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=e5b5b2d3a18f85f9fdd9d688d3fccaed8737cded">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">ぬめぬめ動く棒グラフ Bar Chart Race を描いてみよう: 準備編</h1>
      <h2 class="project-tagline">Export Matlab Live Scripts to Markdown</h2>
      
        <a href="https://github.com/janklab/MlxShake" class="btn">View on GitHub</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <h1 id="ぬめぬめ動く棒グラフ-bar-chart-race-を描いてみよう-準備編">ぬめぬめ動く棒グラフ Bar Chart Race を描いてみよう: 準備編</h1>

<p>Copyright 2020 The MathWorks, Inc.</p>

<h1 id="使い方">使い方</h1>

<pre><code class="language-matlab:Code(Display)">livescript2markdown('barChartRaceExample_part1','format','qiita');
</code></pre>

<p>で出力した Markdown の Qiita での表示こちら：<a href="https://qiita.com/eigs/items/62fbc0b6bdc5e7094abf">https://qiita.com/eigs/items/62fbc0b6bdc5e7094abf</a></p>

<p><strong>注意：画像部分は別途 Drag \&amp; Drop で Qiita に載せる必要があります。</strong></p>

<h1 id="はじめに">はじめに</h1>

<p>最近よくみるこんなプロット：各データの時系列変化を順位とともに表現するプロットです。時間とともに順位が入れ替わるので Bar Chart Race とか呼ばれている（？）ようで、検索するといろんなデータの可視化がみられます。</p>

<p>これを MATLAB で書けないのか、、という声が答えてきた気がしましたので、やってみました。</p>

<p>今回は準備編として描画に必要な要素がそろっているかの確認をします。 <code class="language-plaintext highlighter-rouge">barh</code> 関数の機能を確認してみましょう。</p>

<p>&lt;–
<strong>Please drag &amp; drop an image file here</strong>
Filename: <strong>barChartRaceExample_part1_images/image_0.png</strong>
If you want to set the image size use the following command
&lt;img src=” alt=”attach:cat” title=”attach:cat” width=500px&gt;
–&gt;</p>

<h1 id="横棒グラフのプロット">横棒グラフのプロット</h1>

<p>まずは棒グラフ <code class="language-plaintext highlighter-rouge">barh</code> を書いてみます。</p>

<pre><code class="language-matlab:Code">clear; close all
x = 1:5;
y = (1:5)/10;
handle_bar = barh(x,y);
</code></pre>

<p>&lt;–
<strong>Please drag &amp; drop an image file here</strong>
Filename: <strong>barChartRaceExample_part1_images/figure_0.png</strong>
If you want to set the image size use the following command
&lt;img src=” alt=”attach:cat” title=”attach:cat” width=500px&gt;
–&gt;</p>

<p>簡単ですね。x が縦の位置、y が棒の長さを決めます。</p>

<p><code class="language-plaintext highlighter-rouge">barh</code> がややこしいのは <code class="language-plaintext highlighter-rouge">x</code> が縦軸上での位置、<code class="language-plaintext highlighter-rouge">y </code>が対応する棒の長さである点。直感的に <code class="language-plaintext highlighter-rouge">x</code> と <code class="language-plaintext highlighter-rouge">y</code> が逆転しているように感じる点。</p>

<h1 id="棒グラフの棒の位置を指定整数">棒グラフの棒の位置を指定（整数）</h1>

<p>プロパティを見てみます。</p>

<pre><code class="language-matlab:Code">handle_bar
</code></pre>

<pre><code class="language-text:Output">handle_bar = 
  Bar のプロパティ:

    BarLayout: 'grouped'
     BarWidth: 0.8000
    FaceColor: [0 0.4470 0.7410]
    EdgeColor: [0 0 0]
    BaseValue: 0
        XData: [1 2 3 4 5]
        YData: [0.1000 0.2000 0.3000 0.4000 0.5000]

  すべてのプロパティ を表示

</code></pre>

<p>棒グラフの位置（縦方向）は <code class="language-plaintext highlighter-rouge">XData</code> プロパティで変更できそうです。例えば 2 と 3 を入れ替えてみます。</p>

<pre><code class="language-matlab:Code">handle_bar.XData = [1,3,2,4,5];
</code></pre>

<p>&lt;–
<strong>Please drag &amp; drop an image file here</strong>
Filename: <strong>barChartRaceExample_part1_images/figure_1.png</strong>
If you want to set the image size use the following command
&lt;img src=” alt=”attach:cat” title=”attach:cat” width=500px&gt;
–&gt;</p>

<p>3 と 2 の位置が逆転しました。</p>

<h1 id="棒グラフの棒の位置を指定小数点">棒グラフの棒の位置を指定（小数点）</h1>

<p>小数点（不均等な位置指定）もできれば、順位が入れ替わる遷移を表現できそうな気がします。</p>

<p>2 を 2.8 に 3 を 2.2 にして、すれ違った後を表現してみます。</p>

<pre><code class="language-matlab:Code">handle_bar.XData = [1,2.8,2.2,4,5];
</code></pre>

<p>&lt;–
<strong>Please drag &amp; drop an image file here</strong>
Filename: <strong>barChartRaceExample_part1_images/figure_2.png</strong>
If you want to set the image size use the following command
&lt;img src=” alt=”attach:cat” title=”attach:cat” width=500px&gt;
–&gt;</p>

<h2 id="ちょっと違う">ちょっと違う</h2>

<p>位置が変わったのはいいが何かがおかしい。棒の幅が細い！</p>

<p>これは <code class="language-plaintext highlighter-rouge">barh </code>関数が気を利かせてくれて、それぞれの棒が重ならないように描画するためです。ま、気持ちはわからんでもない。</p>

<p>ここを打開するには <code class="language-plaintext highlighter-rouge">BarWidth</code> プロパティです。既定値は <code class="language-plaintext highlighter-rouge">0.8</code> であり、MATLAB で少し間隔を空けて各バーが表示されます。このプロパティを <code class="language-plaintext highlighter-rouge">1</code> に設定すると、バー同士が隙間なく表示されます。参照：<a href="https://www.mathworks.com/help/matlab/ref/matlab.graphics.chart.primitive.bar-properties.html">Bar のプロパティ</a></p>

<pre><code class="language-matlab:Code">handle_bar.BarWidth
</code></pre>

<pre><code class="language-text:Output">ans = 0.8000
</code></pre>

<h1 id="barwidth-プロパティ"><code class="language-plaintext highlighter-rouge">BarWidth</code> プロパティ</h1>

<p>ではこれをいくつにすればいいのか。間隔がちょうど１だった時には 0.8 でいい感じの表示でした。</p>

<p>では直感的にデータの幅に反比例するように <code class="language-plaintext highlighter-rouge">BarWidth</code> の値を大きくすればいいのでは？</p>

<p>やってみます。現時点では</p>

<pre><code class="language-matlab:Code">tmp = handle_bar.XData
</code></pre>

<pre><code class="language-text:Output">tmp = 1x5    
    1.0000    2.8000    2.2000    4.0000    5.0000

</code></pre>

<p>という位置関係なので、最も近い位置にある棒同士の距離を使って計算してみましょう。</p>

<pre><code class="language-matlab:Code">scaleWidth = min(diff(sort(tmp)))
</code></pre>

<pre><code class="language-text:Output">scaleWidth = 0.6000
</code></pre>

<p><code class="language-plaintext highlighter-rouge">一度 sort</code> しているのは、逆転してるからです。この値を使って <code class="language-plaintext highlighter-rouge">BarWidth</code> の値を既定値の 0.8 のような見栄えになるように変えてみます。</p>

<pre><code class="language-matlab:Code">handle_bar.BarWidth = 0.8/scaleWidth;
</code></pre>

<p>&lt;–
<strong>Please drag &amp; drop an image file here</strong>
Filename: <strong>barChartRaceExample_part1_images/figure_3.png</strong>
If you want to set the image size use the following command
&lt;img src=” alt=”attach:cat” title=”attach:cat” width=500px&gt;
–&gt;</p>

<p>おぉ、できたっぽい。</p>

<p>これで、y 軸の位置をランキング（順位）に該当するように <code class="language-plaintext highlighter-rouge">XData</code> プロパティを変更すればいいですね。ぬめぬめ遷移させるには、ランキングの入れ替え部分を内挿してちょっとずつ順位が入れ替わるようにすれば、ぬめぬめ遷移が表現できそうな気がしてきました！</p>

<h1 id="軸などの表示">軸などの表示</h1>

<p>y 軸に少数点が表れているのが気になりますので、この辺綺麗にしてみましょう。</p>

<p>使うのは <code class="language-plaintext highlighter-rouge">Axes</code> オブジェクトの <code class="language-plaintext highlighter-rouge">YTick</code> と <code class="language-plaintext highlighter-rouge">YTickLabel</code> です。それぞれの棒のラベルは</p>

<pre><code class="language-matlab:Code">names = ["A","B","C","D","E"];
</code></pre>

<p>とします。まずはラベルを表示する位置 <code class="language-plaintext highlighter-rouge">YTick</code> を指定します。ランキング（位置）に相当する <code class="language-plaintext highlighter-rouge">XData</code> プロパティ値をそのまま入れてみます。</p>

<pre><code class="language-matlab:Code">handle_axes = gca;
</code></pre>

<pre><code class="language-matlab:Code">try
    handle_axes.YTick = handle_bar.XData;
catch ME
    disp(ME.message)
end
</code></pre>

<pre><code class="language-text:Output">値は単精度型または倍精度型のベクトルで、値が増加しなければなりません
</code></pre>

<h1 id="ytick-は単調増加じゃないと">YTick は単調増加じゃないと</h1>

<p>エラーがでました。<code class="language-plaintext highlighter-rouge">YTick</code> には<strong>単調増加</strong>した値を与えないとエラーがでます。ソートしておきましょう。(小さい順)</p>

<pre><code class="language-matlab:Code">[tmp,idx] = sort(handle_bar.XData,'ascend');
</code></pre>

<p><code class="language-plaintext highlighter-rouge">XData</code> の並べ替えに応じて <code class="language-plaintext highlighter-rouge">names</code> の順番も変えておく必要があるので、第二出力引数の <code class="language-plaintext highlighter-rouge">idx</code> も使います。</p>

<pre><code class="language-matlab:Code">handle_axes.YTick = tmp;
handle_axes.YTickLabel = names(idx);
</code></pre>

<p>&lt;–
<strong>Please drag &amp; drop an image file here</strong>
Filename: <strong>barChartRaceExample_part1_images/figure_4.png</strong>
If you want to set the image size use the following command
&lt;img src=” alt=”attach:cat” title=”attach:cat” width=500px&gt;
–&gt;</p>

<p>B と C が入れ替わっている感じがでてますね！</p>

<h1 id="残念な点色の問題">残念な点：色の問題</h1>

<p><code class="language-plaintext highlighter-rouge">barh</code> の残念な点なんですが、1 つの bar オブジェクトに対して色は1色しか指定できません。</p>

<p>なので、色の種類だけ <code class="language-plaintext highlighter-rouge">barh</code> を実行して異なる bar オブジェクトを作ればればいいですね。</p>

<pre><code class="language-matlab:Code">figure
x = 1:5;
y1 = [1:4,0]/10;
y2 = [0,0,0,0,5]/10;
handle_bar1 = barh(x,y1);
hold on
handle_bar2 = barh(x,y2);
hold off
</code></pre>

<p>&lt;–
<strong>Please drag &amp; drop an image file here</strong>
Filename: <strong>barChartRaceExample_part1_images/figure_5.png</strong>
If you want to set the image size use the following command
&lt;img src=” alt=”attach:cat” title=”attach:cat” width=500px&gt;
–&gt;</p>

<h1 id="まとめ">まとめ</h1>

<p>準備編はここまで！色の数だけ bar オブジェクトを作るといろいろ大変そうですが、むしろいろいろ自由にカスタマイズできていいかもしれない。</p>

<p>できそうな気がしてきました。次はサンプルデータを使ってランキングが推移するアニメーションを書いてみます。</p>

<p>やることは以下の2点</p>

<ul>
  <li>複数の時系列データの各時点での値の順位付け</li>
  <li>順位が入れ替わる遷移部分を表示するためのデータの内挿</li>
</ul>

<p>これができれば、あとは bar オブジェクトに値を入れていくだけです。</p>



      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/janklab/MlxShake">MlxShake</a> is maintained by <a href="https://github.com/janklab">janklab</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
  </body>
</html>
